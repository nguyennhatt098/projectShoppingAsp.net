@model List<Model.Product>
@{
	ViewBag.Title = "Danh Mục Sản Phẩm";
	Layout = "~/Views/Shared/_Layout.cshtml";
	var listCategory = (List<Model.Category>)ViewBag.ListCategory;
	var category = (Model.Category)ViewBag.Category;
	var wishList = (List<Model.WishList>)ViewBag.wishList;
	var user = (Model.User)Session["User"];
	var reviewProductList = (List<Model.ReviewProduct>)ViewBag.ReviewList;
}

<div class="space-custom"></div>
<!-- breadcrumb start -->
<div class="breadcrumb-area ">
	<div class="container">
		<ol class="breadcrumb">
			<li><a href="#"><i class="fa fa-home"></i></a></li>
			<li><a href="#">Danh Mục Sản Phẩm</a></li>
			<li class="active">@category.Name</li>
		</ol>
	</div>
</div>
<!-- breadcrumb end -->
<!-- shop-area start -->
<div class="shop-area">
	<div class="container">
		<div class="row ">
			<div style="background:#f0f0f0;border-left: 1px dotted rgba(0, 0, 0, 0.5);box-shadow: 3px 3px;height:auto" class="col-md-3 col-sm-4">
				@*menu mobile*@
				<div id="accordian">
					<ul>
						<li class="active">
							<h3><a href="javascript:void(0)"><i class="fa fa-lg fa-tasks"></i>Danh mục</a></h3>
							<ul>
								@foreach (var itemGrandParent in listCategory)
								{
									var url = "/danh-muc-san-pham/" + itemGrandParent.Slug + "-" + itemGrandParent.ID;
									if (itemGrandParent.ParentID == null && listCategory.Any(x => x.ParentID == itemGrandParent.ID))
									{
										<li>
											<a href="javascript:void(0)">@itemGrandParent.Name</a>
											<ul>
												@foreach (var itemParent in listCategory)
												{
													var urlParent = "/danh-muc-san-pham/" + itemParent.Slug + "-" + itemParent.ID;
													if (itemGrandParent.ID == itemParent.ParentID && listCategory.Any(x => x.ParentID == itemParent.ID))
													{
														<li>
															<a href="javascript:void(0)">@itemParent.Name</a>
															<ul>
																@foreach (var itemChild in listCategory)
																{
																	var urlChild = "/danh-muc-san-pham/" + itemChild.Slug + "-" + itemChild.ID;
																	if (itemParent.ID == itemChild.ParentID)
																	{
																		<li>
																			<a href="@urlChild">
																				@itemChild.Name
																			</a>
																		</li>
																	}
																}
															</ul>
														</li>
													}
													else if (itemGrandParent.ID == itemParent.ParentID)
													{
														<li><a href="@urlParent">@itemParent.Name</a></li>
													}
												}
											</ul>
										</li>
									}
									else if (itemGrandParent.ParentID == null)
									{
										<li><a href="@url"> @itemGrandParent.Name </a></li>
									}

								}
							</ul>
						</li>
					</ul>
				</div>
				<div class="column">
					<h2 class="title-block">Danh Mục Sản Phẩm</h2>

					@*menu desktop*@
					<div class="container-menu-product">
						<ul class="">
							@foreach (var itemGrandParent in listCategory)
							{
								var url = "/danh-muc-san-pham/" + itemGrandParent.Slug + "-" + itemGrandParent.ID;
								if (itemGrandParent.ParentID == null && listCategory.Any(x => x.ParentID == itemGrandParent.ID))
								{
									<li class="">
										<a href="javascript:void(0)">@itemGrandParent.Name<span style="float: right" class="glyphicon glyphicon-chevron-right"></span></a>
										<ul class="">
											@foreach (var itemParent in listCategory)
											{
												var urlParent = "/danh-muc-san-pham/" + itemParent.Slug + "-" + itemParent.ID;
												if (itemGrandParent.ID == itemParent.ParentID && listCategory.Any(x => x.ParentID == itemParent.ID))
												{

													<li class="">
														<a href="javascript:void(0)">@itemParent.Name<span style="float: right" class="glyphicon glyphicon-chevron-right"></span></a>
														<ul>
															@foreach (var itemChild in listCategory)
															{
																var urlChild = "/danh-muc-san-pham/" + itemChild.Slug + "-" + itemChild.ID;
																if (itemParent.ID == itemChild.ParentID)
																{
																	<li>
																		<a href="@urlChild">
																			@itemChild.Name
																		</a>
																	</li>
																}
															}

														</ul>
													</li>

												}
												else if (itemGrandParent.ID == itemParent.ParentID)
												{
													<li><a href="@urlParent">@itemParent.Name</a></li>
												}

											}

										</ul>
									</li>
								}
								else if (itemGrandParent.ParentID == null)
								{
									<li><a href="@url">@itemGrandParent.Name</a></li>
								}

							}
						</ul>
					</div>
				</div>
			</div>
			<div class="col-md-8 col-sm-8">
				<h2 class="page-heading mt-40">
					<span class="cat-name">@category.Name</span>
					<span class="heading-counter">There are @ViewBag.CountProduct products.</span>
				</h2>
				<div class="shop-page-bar">
					<div>
						<div class="shop-bar">
							<!-- Nav tabs -->
							<ul class="shop-tab f-left" role="tablist">
								<li style="border:1px solid grey" role="presentation" class="active"><a href="#home" data-toggle="tab"><i class="fa fa-th-large" aria-hidden="true"></i></a></li>
								<li style="border:1px solid grey" role="presentation"><a href="#profile" data-toggle="tab"><i class="fa fa-th-list" aria-hidden="true"></i></a></li>
							</ul>
							<div class="selector-field f-left ml-20 hidden-xs">
								<form action="#">
									<label>Sort by</label>
									<select name="select">
										<option value="">----</option>
										<option value="">Price: Lowest first</option>
										<option value="">Price: Highest first</option>
										<option value="">Product Name: A to Z</option>
										<option value="">Product Name: Z to A</option>
										<option value="">In stock</option>
										<option value="">Reference: Lowest first</option>
										<option value="">Reference: Highest first</option>
									</select>
								</form>
							</div>
							<div class="selector-field f-left ml-30 hidden-xs">

							</div>
							<div class="selector-field f-right ml-30">
								<form action="#">
									<button class="compare">Compare (1)</button>
								</form>
							</div>
						</div>
						<!-- Tab panes -->
						<div class="tab-content reload-wish">
							<div role="tabpanel" class="tab-pane active" id="home">
								<div class="row product-parent">
									@if (Model.Count > 0)
									{
										foreach (var item in Model)
										{
											float totalStar = 0;
											var reviewProducts = reviewProductList.Where(x => x.ProductId == item.Id).ToList();
											foreach (var itemReview in reviewProducts)
											{
												totalStar += itemReview.Rate;

											}
											float currentStar = totalStar / reviewProducts.Count();
											var url = "/chi-tiet-san-pham/" + item.Slug + "-" + item.Id;
											<div class="col-md-4 col-sm-6 product-child">
												<div class="product-wrapper mb-40">
													<div class="product-img">

														<a href="@url"><img style="width: 100%" src="@item.Images" alt="" /></a>
														<span class="new-label">New</span>
														<div class="product-action">
															<a href="/them-vao-gio-hang?productID=@item.Id&quantity=1"><i class="pe-7s-cart"></i></a>
															@if (user == null)
															{
																<a data-toggle="modal" data-target="#checkWishLish" href="#"><i class="fa fa-heart"></i></a>
															}
															else if (wishList.Any(x => x.ProductID.Equals(item.Id)))
															{
																<a class="wishlist wishlistDisLike wishlist-@item.Id" id="@item.Id" data-id="@item.Id" href="javascript:void(0)"><i class="fa fa-heart"></i></a>
															}
															else
															{
																<a class="wishlist wishlist-@item.Id" data-id="@item.Id" id="@item.Id" href="javascript:void(0)"><i class="fa fa-heart"></i></a>
															}
															<a href="@url"><i class="pe-7s-look"></i></a>
														</div>
													</div>
													<div class="product-content">
														<div class="pro-title">
															<h3><a href="@url">@item.Name</a></h3>
														</div>
														<div class="price-reviews">
															<div class="price-box">
																<span class="price product-price">
																	@if (item.Sale_Price != null)
																	{
																		<span class="old-price product-price">@String.Format("{0:n0}", item.Price) VND</span>
																		<span class="price product-price">@String.Format("{0:n0}", item.Sale_Price) VND</span>
																	}
																	else
																	{
																		<span class="price product-price">@String.Format("{0:n0}", item.Price) VND</span>
																	}
																</span>
															</div>
															<div class="pro-rating">
																@if (reviewProducts.Count > 0)
																{
																	var check = true;
																	for (int i = 1; i <= 5; i++)
																	{
																		if (i <= currentStar)
																		{
																			<i class="fa fa-star"></i>

																		}
																		else if ((Math.Abs(currentStar - Math.Floor(currentStar)) > 0) && check)
																		{
																			check = false;
																			<i class="fa fa-star-half-o" aria-hidden="true"></i>
																		}
																		else
																		{
																			<i class="fa fa-star-o" aria-hidden="true"></i>
																		}
																	}
																}
															</div>
														</div>
													</div>
												</div>
											</div>
										}
									}
									else
									{
										<p>Danh Mục Không Có Sản Phẩm</p>
									}
								</div>
							</div>
							<div role="tabpanel" class="tab-pane" id="profile">
								@if (Model.Count > 0)
								{
									foreach (var item in Model)
									{
										float totalStar = 0;
										var reviewProducts = reviewProductList.Where(x => x.ProductId == item.Id).ToList();
										foreach (var itemReview in reviewProducts)
										{
											totalStar += itemReview.Rate;

										}
										float currentStar = totalStar / reviewProducts.Count();
										var url = "/chi-tiet-san-pham/" + item.Slug + "-" + item.Id;
										<div class="row mb-50">
											<div class="col-xs-5 col-sm-5 col-md-4">
												<div class="product-wrapper">
													<div class="product-img">
														<a href="@url"><img src="@item.Images" alt="" /></a>
														<span class="new-label">New</span>
													</div>
												</div>
											</div>
											<div class="col-xs-7 col-sm-7 col-md-8">
												<div class="product-content product-list">
													<div class="pro-title">
														<h3><a href="@url">@item.Name </a></h3>
													</div>
													<div class="price-reviews">
														<div class="price-box">
															@if (item.Sale_Price != null)
															{
																<span class="old-price product-price">@String.Format("{0:n0}", item.Price) VND</span>
																<span class="price product-price">@String.Format("{0:n0}", item.Sale_Price) VND</span>
															}
															else
															{
																<span class="price product-price">@String.Format("{0:n0}", item.Price) VND</span>
															}
														</div>
														<div class="pro-rating">
															@if (reviewProducts.Count > 0)
															{
																var check = true;
																for (int i = 1; i <= 5; i++)
																{
																	if (i <= currentStar)
																	{
																		<i class="fa fa-star"></i>

																	}
																	else if ((Math.Abs(currentStar - Math.Floor(currentStar)) > 0) && check)
																	{
																		check = false;
																		<i class="fa fa-star-half-o" aria-hidden="true"></i>
																	}
																	else
																	{
																		<i class="fa fa-star-o" aria-hidden="true"></i>
																	}
																}
															}
														</div>
													</div>
													<p>@item.Content</p>
													<div class="product-action">
														<a class="cart" href="/them-vao-gio-hang?productID=@item.Id&quantity=1"><span>Add to cart</span></a>
														@if (user == null)
														{
															<a data-toggle="modal" data-target="#exampleModalCenter" href="#"><i class="fa fa-heart"></i></a>
														}
														else if (wishList.Any(x => x.ProductID.Equals(item.Id)))
														{
															<a class="wishlist wishlistDisLike wishlist-@item.Id" id="@item.Id" data-id="@item.Id" href="javascript:void(0)"><i class="fa fa-heart"></i></a>
														}
														else
														{
															<a class="wishlist wishlist-@item.Id" data-id="@item.Id" id="@item.Id" href="javascript:void(0)"><i class="fa fa-heart"></i></a>
														}
														<a href="@url"><i class="pe-7s-look"></i></a>
													</div>
													<div class="color-list">
														<a href="#"></a>
														<a href="#"></a>
													</div>
												</div>
											</div>
										</div>
									}
								}

							</div>
							<div class="content-sortpagibar">

								@if (ViewBag.TotalPage > 1)
								{
									int totalpage = (int)ViewBag.TotalPage;
									int cureentPage = ((int)ViewBag.Page);
									var next20 = cureentPage + 20;
									var prev20 = cureentPage - 20;
									var prev = cureentPage - 1;
									var next = cureentPage + 1;
									var start = (cureentPage <= 3 || totalpage == 0) ? 1 : cureentPage - 3;
									var end = (totalpage <= cureentPage) ? cureentPage : cureentPage + 3;
									if (end >= totalpage)
									{
										end = totalpage;
									}
									var url = "/danh-muc-san-pham/" + category.Slug + "-" + category.ID;
									<div class="product-count display-inline">Showing 1 - @Model.Count of @ViewBag.CountProduct items</div>
									<ul class="shop-pagi display-inline">
										@if (cureentPage > 1)
										{
											if (cureentPage > 20)
											{
												<li><a href="@url?page=@prev20"><i class="fa fa-backward"></i></a></li>
											}
											<li><a href="@url?page=@prev"><i class="fa fa-angle-left"></i></a></li>

										}

										@for (int i = start; i <= end; i++)
										{
											if (cureentPage == i)
											{
												<li class="active"><a href="@url?page=@i">@i</a></li>
											}
											else
											{
												<li><a href="@url?page=@i">@i</a></li>
											}
										}

										@if (cureentPage < totalpage)
										{
											<li><a href="@url?page=@next"><i class="fa fa-angle-right"></i></a></li>
											if (totalpage > cureentPage + 20)
											{
												<li><a href="@url?page=@next20"><i class="fa fa-fast-forward"></i></a></li>
											}

										}

									</ul>
								}
								else
								{

									<ul class="shop-pagi display-inline">

										<li class="active"><a href="javascript:void(0)">1</a></li>

									</ul>

								}

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>



<!-- shop-area end -->
<!-- brand-area start -->
<div class="brand-area">
	<div class="container">
		<div class="brand-sep ptb-50">
			<div class="row">
				<div class="brand-active">
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/1.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/2.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/3.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/4.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/5.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/1.jpg" alt="" /></a>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="single-brand">
							<a href="#"><img src="~/Asset/FrontEnd/img/brand/2.jpg" alt="" /></a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- brand-area end -->
<!-- service-area start -->
